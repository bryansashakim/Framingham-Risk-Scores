mean(1,0,1,1,1,1,0,1)
mean(c(1,0,1,1,1,1,0,1))
mean(c(2,1,2,2,2,2,1,2))-1
log(10.27)
exp(10.27)
?exp
2^5
2^(9)
get_cox_frs = function(dta, riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(dta$ridageyr,wt);m_HDL=weighted.mean(dta$HDL,wt);m_TotChol=weighted.mean(dta$TotChol,wt);m_sbp=weighted.mean(dta$sbp,wt);m_smoke=weighted.mean(dta$smoker,wt);m_diabetic=weighted.mean(dta$diabetic,wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
rho = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
}
return(rho)
}
get_cox_frs(1,53,55,161,125,0,1,2)
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(dta$ridageyr,wt);m_HDL=weighted.mean(dta$HDL,wt);m_TotChol=weighted.mean(dta$TotChol,wt);m_sbp=weighted.mean(dta$sbp,wt);m_smoke=weighted.mean(dta$smoker,wt);m_diabetic=weighted.mean(dta$diabetic,wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
rho = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
}
return(rho)
}
get_cox_frs(1,53,55,161,125,0,1,2)
1 - (m_base10^(exp(24.3509-23.9802)))
### Required packages ###
library(ggplot2); library(dplyr); library(tidyr);library(haven);library(readstata13);library(foreign)
### Parameters ###
f_base10 = 0.95012 # baseline 10-year survival for females
m_base10 = 0.88936 # baseline 10-year survival for males
f_rf <- list(log_age = 2.32888, log_hdl = -0.70833,log_totchol = 1.20904,log_SBP = 2.82263,Smoking = 0.52873,Diabetes = 0.69154) #  log of hazard ratio for each risk factor for females
m_rf <- list(log_age = 3.06117, log_hdl = -0.93263,log_totchol = 1.12370,log_SBP = 1.99881,Smoking = 0.65451,Diabetes = 0.57367) #  log of hazard ratio for each risk factor for males
betas <- list(f=f_rf,m=m_rf) # nested list of f_rf and m_rf
get_cox_frs = function(dta,riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(dta$ridageyr,dta$wt);m_HDL=weighted.mean(dta$HDL,dta$wt);m_TotChol=weighted.mean(dta$TotChol,dta$wt);m_sbp=weighted.mean(dta$sbp,dta$wt);m_smoke=weighted.mean(dta$smoker,dta$wt);m_diabetic=weighted.mean(dta$diabetic,dta$wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 = sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age=weighted.mean(dta$ridageyr,dta$wt);m_HDL=weighted.mean(dta$HDL,dta$wt);m_TotChol=weighted.mean(dta$TotChol,dta$wt);m_sbp=weighted.mean(dta$sbp,dta$wt);m_smoke=weighted.mean(dta$smoker,dta$wt);m_diabetic=weighted.mean(dta$diabetic,dta$wt)
arg2 = sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk = 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
# order: riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic
##########################################
##               1999-2000              ##
##########################################
nhanes1999_2000=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_1999_2000_frs.dta")
View(nhanes1999_2000)
View(nhanes1999_2000)
# Getting cox model based risk levels
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$smoke_sts,nhanes1999_2000$lbxgh,nhanes1999_2000$wtint2yr)
colnames(nhanes1999_2000)
get_cox_frs = function(dta,riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
print("hi")
m_age=weighted.mean(dta$ridageyr,dta$wt);m_HDL=weighted.mean(dta$HDL,dta$wt);m_TotChol=weighted.mean(dta$TotChol,dta$wt);m_sbp=weighted.mean(dta$sbp,dta$wt);m_smoke=weighted.mean(dta$smoker,dta$wt);m_diabetic=weighted.mean(dta$diabetic,dta$wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 = sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age=weighted.mean(dta$ridageyr,dta$wt);m_HDL=weighted.mean(dta$HDL,dta$wt);m_TotChol=weighted.mean(dta$TotChol,dta$wt);m_sbp=weighted.mean(dta$sbp,dta$wt);m_smoke=weighted.mean(dta$smoker,dta$wt);m_diabetic=weighted.mean(dta$diabetic,dta$wt)
arg2 = sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk = 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
get_cox_frs = function(dta,riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
print("hi")
m_age=weighted.mean(dta$ridageyr,dta$wt);m_HDL=weighted.mean(dta$HDL,dta$wt);m_TotChol=weighted.mean(dta$TotChol,dta$wt);m_sbp=weighted.mean(dta$sbp,dta$wt);m_smoke=weighted.mean(dta$smoker,dta$wt);m_diabetic=weighted.mean(dta$diabetic,dta$wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 = sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
print("hi")
m_age=weighted.mean(dta$ridageyr,dta$wt);m_HDL=weighted.mean(dta$HDL,dta$wt);m_TotChol=weighted.mean(dta$TotChol,dta$wt);m_sbp=weighted.mean(dta$sbp,dta$wt);m_smoke=weighted.mean(dta$smoker,dta$wt);m_diabetic=weighted.mean(dta$diabetic,dta$wt)
arg2 = sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk = 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
# Getting cox model based risk levels
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$smoke_sts,nhanes1999_2000$lbxgh,nhanes1999_2000$wtint2yr)
get_cox_frs = function(dta,riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 = sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 = sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk = 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
# Getting cox model based risk levels
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$smoke_sts,nhanes1999_2000$lbxgh,nhanes1999_2000$wtint2yr)
# Getting cox model based risk levels
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
View(nhanes1999_2000)
unique(nhanes1999_2000$cox_frs)
nhanes1999_2000=nhanes1999_2000[,-c(length(colnames(nhanes1999_2000)))]
mapply(paste, 1:3, 4:8)
# Getting cox model based risk levels
nhanes1999_2000= nhanes1999_2000[complete.cases(nhanes1999_2000[ , c("riagendr","ridageyr","lbdhdl","lbxtc","bpxsar","isSmoker","isDiabetic")]),]
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
length(nhanes1999_2000$riagendr)
length(nhanes1999_2000$ridageyr)
length(nhanes1999_2000$lbdhdl)
length(nhanes1999_2000$lbxtc)
length(nhanes1999_2000$bpxsar)
length(nhanes1999_2000$isSmoker)
length(nhanes1999_2000$isDiabetic)
View(nhanes1999_2000)
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 = sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 = sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk = 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
nhanes1999_2000$ridageyr[1]
nhanes1999_2000$lbdhdl[1]
nhanes1999_2000$lbxtc[1]
nhanes1999_2000$bpxsar[1]
nhanes1999_2000$isSmoker[1]
nhanes1999_2000$isDiabetic[1]
nhanes1999_2000$riagendr[1]
arg1 = sum((m_rf[[1]]*log(77)),(m_rf[[2]]*log(54)),(m_rf[[3]]*log(215)),(m_rf[[4]]*log(98)),(m_rf[[5]]*0),(m_rf[[6]]*0))
m_age=weighted.mean(nhanes_1999_2000$ridageyr,nhanes_1999_2000$nhanes_1999_2000$wtint2yr);m_HDL=weighted.mean(nhanes_1999_2000$lbdhdl,nhanes_1999_2000$wtint2yr);m_TotChol=weighted.mean(nhanes_1999_2000$lbxtc,nhanes_1999_2000$wtint2yr);m_sbp=weighted.mean(nhanes_1999_2000$bpxsar,nhanes_1999_2000$wtint2yr);m_smoke=weighted.mean(nhanes_1999_2000$isSmoker,nhanes_1999_2000$wtint2yr);m_diabetic=weighted.mean(nhanes_1999_2000$isDiabetic,nhanes_1999_2000$wtint2yr)
m_age=weighted.mean(nhanes1999_2000$ridageyr,nhanes1999_2000$nhanes1999_2000$wtint2yr);m_HDL=weighted.mean(nhanes1999_2000$lbdhdl,nhanes1999_2000$wtint2yr);m_TotChol=weighted.mean(nhanes1999_2000$lbxtc,nhanes1999_2000$wtint2yr);m_sbp=weighted.mean(nhanes1999_2000$bpxsar,nhanes1999_2000$wtint2yr);m_smoke=weighted.mean(nhanes1999_2000$isSmoker,nhanes1999_2000$wtint2yr);m_diabetic=weighted.mean(nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
m_age=weighted.mean(nhanes_1999_2000$ridageyr,nhanes_1999_2000$wtint2yr);m_HDL=weighted.mean(nhanes_1999_2000$lbdhdl,nhanes_1999_2000$wtint2yr);m_TotChol=weighted.mean(nhanes_1999_2000$lbxtc,nhanes_1999_2000$wtint2yr);m_sbp=weighted.mean(nhanes_1999_2000$bpxsar,nhanes_1999_2000$wtint2yr);m_smoke=weighted.mean(nhanes_1999_2000$isSmoker,nhanes_1999_2000$wtint2yr);m_diabetic=weighted.mean(nhanes_1999_2000$isDiabetic,nhanes_1999_2000$wtint2yr)
m_age=weighted.mean(nhanes1999_2000$ridageyr,nhanes1999_2000$wtint2yr);m_HDL=weighted.mean(nhanes1999_2000$lbdhdl,nhanes1999_2000$wtint2yr);m_TotChol=weighted.mean(nhanes1999_2000$lbxtc,nhanes1999_2000$wtint2yr);m_sbp=weighted.mean(nhanes1999_2000$bpxsar,nhanes1999_2000$wtint2yr);m_smoke=weighted.mean(nhanes1999_2000$isSmoker,nhanes1999_2000$wtint2yr);m_diabetic=weighted.mean(nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
risk
View(nhanes1999_2000)
# order: riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic
##########################################
##               1999-2000              ##
##########################################
nhanes1999_2000=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_1999_2000_frs.dta")
# Getting cox model based risk levels
nhanes1999_2000= nhanes1999_2000[complete.cases(nhanes1999_2000[ , c("riagendr","ridageyr","lbdhdl","lbxtc","bpxsar","isSmoker","isDiabetic")]),]
# order: riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic
##########################################
##               1999-2000              ##
##########################################
nhanes1999_2000=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_1999_2000_frs.dta")
# Getting cox model based risk levels
nhanes1999_2000= nhanes1999_2000[complete.cases(nhanes1999_2000[ , c("riagendr","ridageyr","lbdhdl","lbxtc","bpxsar","isSmoker","isDiabetic")]),]
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
View(nhanes1999_2000)
get_cox_frs(1,77,54215,98,0,0,26678.636)
get_cox_frs(1,77,54,215,98,0,0,26678.636)
get_cox_frs(1,77,54,2115,98,0,0,26678.636)
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
risk = 0
#### MALES ####
if (riagendr == 1) {
arg1 = sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 = sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk = 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 = sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 = sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk = 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
get_cox_frs(1,77,54,2115,98,0,0,26678.636)
get_cox_frs(1,77,54,215,98,0,0,26678.636)
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 <<- sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk <<- 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 <<- sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age=weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk <<- 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
get_cox_frs(1,77,54,215,98,0,0,26678.636)
get_cox_frs(1,77,54,115,98,0,0,26678.636)
m_rf[[1]]
m_rf[[1]]+5
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
#### MALES ####
if (riagendr == 1) {
arg1 <<- sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk <<- 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 <<- sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk <<- 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
get_cox_frs(1,77,54,215,98,0,0,26678.636)
get_cox_frs(1,77,54,115,98,0,0,26678.636)
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
risk <<- 0
#### MALES ####
if (riagendr == 1) {
arg1 <<- sum((m_rf[[1]]*log(ridageyr)),(m_rf[[2]]*log(HDL)),(m_rf[[3]]*log(TotChol)),(m_rf[[4]]*log(sbp)),(m_rf[[5]]*smoker),(m_rf[[6]]*diabetic))
m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk <<- 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 <<- sum((f_rf[[1]]*log(ridageyr)),(f_rf[[2]]*log(HDL)),(f_rf[[3]]*log(TotChol)),(f_rf[[4]]*log(sbp)),(f_rf[[5]]*smoker),(f_rf[[6]]*diabetic))
m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk <<- 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
View(nhanes1999_2000)
get_cox_frs(1,77,54,215,98,0,0,26678.636)
unique(nhanes1999_2000$cox_frs)
unique(nhanes1999_2000$cox_frs)[1]
unique(nhanes1999_2000$cox_frs)[2]
unique(nhanes1999_2000$cox_frs)[3]
log_age = 3.06117; log_hdl = -0.93263;log_totchol = 1.12370;log_SBP = 1.99881;Smoking = 0.65451;Diabetes = 0.57367 #  log of hazard ratio for each risk factor for males
m_log_age = 3.06117; m_log_hdl = -0.93263;m_log_totchol = 1.12370;m_log_SBP = 1.99881;m_Smoking = 0.65451;m_Diabetes = 0.57367 #  log of hazard ratio for each risk factor for males
f_log_age = 2.32888; f_log_hdl = -0.70833;f_log_totchol = 1.20904;f_log_SBP = 2.82263;f_Smoking = 0.52873;f_Diabetes = 0.69154 #  log of hazard ratio for each risk factor for females
m_log_age = 3.06117; m_log_hdl = -0.93263;m_log_totchol = 1.12370;m_log_SBP = 1.99881;m_Smoking = 0.65451;m_Diabetes = 0.57367 #  log of hazard ratio for each risk factor for males
f_log_age = 2.32888; f_log_hdl = -0.70833;f_log_totchol = 1.20904;f_log_SBP = 2.82263;f_Smoking = 0.52873;f_Diabetes = 0.69154 #  log of hazard ratio for each risk factor for females
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
risk <<- 0
#### MALES ####
if (riagendr == 1) {
arg1 <<- sum((m_log_age*log(ridageyr)),(m_log_hdl*log(HDL)),(m_log_totchol*log(TotChol)),(m_log_SBP*log(sbp)),(m_Smoking*smoker),(m_Diabetes*diabetic))
m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk <<- 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 <<- sum((f_log_age*log(ridageyr)),(f_log_hdl*log(HDL)),(f_log_totchol*log(TotChol)),(f_log_SBP*log(sbp)),(f_Smoking*smoker),(f_Diabetes*diabetic))
m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk <<- 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
# order: riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic
##########################################
##               1999-2000              ##
##########################################
nhanes1999_2000=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_1999_2000_frs.dta")
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
View(nhanes1999_2000)
get_cox_frs(1,77,54,215,98,0,0,26678.636)
get_cox_frs = function(riagendr,ridageyr,HDL,TotChol,sbp,smoker,diabetic,wt) {
risk <<- 0
#### MALES ####
if (riagendr == 1) {
arg1 <<- sum((m_log_age*log(ridageyr)),(m_log_hdl*log(HDL)),(m_log_totchol*log(TotChol)),(m_log_SBP*log(sbp)),(m_Smoking*smoker),(m_Diabetes*diabetic))
#m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((m_rf[[1]]*log(m_age)),(m_rf[[2]]*log(m_HDL)),(m_rf[[3]]*log(m_TotChol)),(m_rf[[4]]*log(m_sbp)),(m_rf[[5]]*m_smoke),(m_rf[[6]]*m_diabetic))
risk <<- 1 - (m_base10^(exp(arg1-arg2)))
}
#### FEMALES ####
else {
arg1 <<- sum((f_log_age*log(ridageyr)),(f_log_hdl*log(HDL)),(f_log_totchol*log(TotChol)),(f_log_SBP*log(sbp)),(f_Smoking*smoker),(f_Diabetes*diabetic))
#m_age <<- weighted.mean(ridageyr,wt);m_HDL=weighted.mean(HDL,wt);m_TotChol=weighted.mean(TotChol,wt);m_sbp=weighted.mean(sbp,wt);m_smoke=weighted.mean(smoker,wt);m_diabetic=weighted.mean(diabetic,wt)
arg2 <<- sum((f_rf[[1]]*log(m_age)),(f_rf[[2]]*log(m_HDL)),(f_rf[[3]]*log(m_TotChol)),(f_rf[[4]]*log(m_sbp)),(f_rf[[5]]*m_smoke),(f_rf[[6]]*m_diabetic))
risk <<- 1 - (f_base10^(exp(arg1-arg2)))
}
return(risk)
}
m_age = weighted.mean(nhanes1999_2000$ridageyr,nhanes1999_2000$wtint2yr)
m_HDL= weighted.mean(nhanes1999_2000$lbdhdl,nhanes1999_2000$wtint2yr)
m_TotChol = weighted.mean(nhanes1999_2000$lbxtc,nhanes1999_2000$wtint2yr)
m_sbp = weighted.mean(nhanes1999_2000$bpxsar,nhanes1999_2000$wtint2yr)
m_smoke = weighted.mean(nhanes1999_2000$isSmoker,nhanes1999_2000$wtint2yr)
m_diabetic = weighted.mean(nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
nhanes1999_2000$cox_frs = mapply(get_cox_frs, nhanes1999_2000$riagendr,nhanes1999_2000$ridageyr,nhanes1999_2000$lbdhdl,nhanes1999_2000$lbxtc,nhanes1999_2000$bpxsar,nhanes1999_2000$isSmoker,nhanes1999_2000$isDiabetic,nhanes1999_2000$wtint2yr)
View(m_rf)
View(nhanes1999_2000)
write_dta(nhanes1999_2000, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_1999_2000_frs.dta")
nhanes2001_2002=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2001_2002_frs.dta")
# Getting cox model based risk levels
nhanes2001_2002= nhanes2001_2002[complete.cases(nhanes2001_2002[ , c("riagendr","ridageyr","lbdhdl","lbxtc","bpxsar","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2001_2002$ridageyr,nhanes2001_2002$wtint2yr)
m_HDL= weighted.mean(nhanes2001_2002$lbdhdl,nhanes2001_2002$wtint2yr)
m_TotChol = weighted.mean(nhanes2001_2002$lbxtc,nhanes2001_2002$wtint2yr)
m_sbp = weighted.mean(nhanes2001_2002$bpxsar,nhanes2001_2002$wtint2yr)
m_smoke = weighted.mean(nhanes2001_2002$isSmoker,nhanes2001_2002$wtint2yr)
m_diabetic = weighted.mean(nhanes2001_2002$isDiabetic,nhanes2001_2002$wtint2yr)
nhanes2001_2002$cox_frs = mapply(get_cox_frs, nhanes2001_2002$riagendr,nhanes2001_2002$ridageyr,nhanes2001_2002$lbdhdl,nhanes2001_2002$lbxtc,nhanes2001_2002$bpxsar,nhanes2001_2002$isSmoker,nhanes2001_2002$isDiabetic,nhanes2001_2002$wtint2yr)
nhanes2003_2004=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2003_2004_frs.dta")
# Getting cox model based risk levels
nhanes2003_2004= nhanes2003_2004[complete.cases(nhanes2003_2004[ , c("riagendr","ridageyr","lbxhdd","lbxtc","bpxsar","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2003_2004$ridageyr,nhanes2003_2004$wtint2yr)
m_HDL= weighted.mean(nhanes2003_2004$lbxhdd,nhanes2003_2004$wtint2yr)
m_TotChol = weighted.mean(nhanes2003_2004$lbxtc,nhanes2003_2004$wtint2yr)
m_sbp = weighted.mean(nhanes2003_2004$bpxsar,nhanes2003_2004$wtint2yr)
m_smoke = weighted.mean(nhanes2003_2004$isSmoker,nhanes2003_2004$wtint2yr)
m_diabetic = weighted.mean(nhanes2003_2004$isDiabetic,nhanes2003_2004$wtint2yr)
nhanes2003_2004$cox_frs = mapply(get_cox_frs, nhanes2003_2004$riagendr,nhanes2003_2004$ridageyr,nhanes2003_2004$lbxhdd,nhanes2003_2004$lbxtc,nhanes2003_2004$bpxsar,nhanes2003_2004$isSmoker,nhanes2003_2004$isDiabetic,nhanes2003_2004$wtint2yr)
View(nhanes2003_2004)
nhanes2005_2006=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2005_2006_frs.dta")
# Getting cox model based risk levels
nhanes2005_2006= nhanes2005_2006[complete.cases(nhanes2005_2006[ , c("riagendr","ridageyr","lbdhdd","lbxtc","bpxsar","isSmoker","isDiabetic")]),]
nhanes2005_2006=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2005_2006_frs.dta")
# Getting cox model based risk levels
nhanes2005_2006= nhanes2005_2006[complete.cases(nhanes2005_2006[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2005_2006$ridageyr,nhanes2005_2006$wtint2yr)
m_HDL= weighted.mean(nhanes2005_2006$lbdhdd,nhanes2005_2006$wtint2yr)
m_TotChol = weighted.mean(nhanes2005_2006$lbxtc,nhanes2005_2006$wtint2yr)
m_sbp = weighted.mean(nhanes2005_2006$asbp,nhanes2005_2006$wtint2yr)
m_smoke = weighted.mean(nhanes2005_2006$isSmoker,nhanes2005_2006$wtint2yr)
m_diabetic = weighted.mean(nhanes2005_2006$isDiabetic,nhanes2005_2006$wtint2yr)
nhanes2005_2006$cox_frs = mapply(get_cox_frs, nhanes2005_2006$riagendr,nhanes2005_2006$ridageyr,nhanes2005_2006$lbdhdl,nhanes2005_2006$lbxtc,nhanes2005_2006$bpxsar,nhanes2005_2006$isSmoker,nhanes2005_2006$isDiabetic,nhanes2005_2006$wtint2yr)
nhanes2005_2006=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2005_2006_frs.dta")
# Getting cox model based risk levels
nhanes2005_2006= nhanes2005_2006[complete.cases(nhanes2005_2006[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2005_2006$ridageyr,nhanes2005_2006$wtint2yr)
m_HDL= weighted.mean(nhanes2005_2006$lbdhdd,nhanes2005_2006$wtint2yr)
m_TotChol = weighted.mean(nhanes2005_2006$lbxtc,nhanes2005_2006$wtint2yr)
m_sbp = weighted.mean(nhanes2005_2006$asbp,nhanes2005_2006$wtint2yr)
m_smoke = weighted.mean(nhanes2005_2006$isSmoker,nhanes2005_2006$wtint2yr)
m_diabetic = weighted.mean(nhanes2005_2006$isDiabetic,nhanes2005_2006$wtint2yr)
nhanes2005_2006$cox_frs = mapply(get_cox_frs, nhanes2005_2006$riagendr,nhanes2005_2006$ridageyr,nhanes2005_2006$lbdhdl,nhanes2005_2006$lbxtc,nhanes2005_2006$asbp,nhanes2005_2006$isSmoker,nhanes2005_2006$isDiabetic,nhanes2005_2006$wtint2yr)
nhanes2005_2006=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2005_2006_frs.dta")
# Getting cox model based risk levels
nhanes2005_2006= nhanes2005_2006[complete.cases(nhanes2005_2006[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2005_2006$ridageyr,nhanes2005_2006$wtint2yr)
m_HDL= weighted.mean(nhanes2005_2006$lbdhdd,nhanes2005_2006$wtint2yr)
m_TotChol = weighted.mean(nhanes2005_2006$lbxtc,nhanes2005_2006$wtint2yr)
m_sbp = weighted.mean(nhanes2005_2006$asbp,nhanes2005_2006$wtint2yr)
m_smoke = weighted.mean(nhanes2005_2006$isSmoker,nhanes2005_2006$wtint2yr)
m_diabetic = weighted.mean(nhanes2005_2006$isDiabetic,nhanes2005_2006$wtint2yr)
nhanes2005_2006$cox_frs = mapply(get_cox_frs, nhanes2005_2006$riagendr,nhanes2005_2006$ridageyr,nhanes2005_2006$lbdhdd,nhanes2005_2006$lbxtc,nhanes2005_2006$asbp,nhanes2005_2006$isSmoker,nhanes2005_2006$isDiabetic,nhanes2005_2006$wtint2yr)
nhanes2007_2008=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2007_2008_frs.dta")
# Getting cox model based risk levels
nhanes2007_2008= nhanes2007_2008[complete.cases(nhanes2007_2008[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2007_2008$ridageyr,nhanes2007_2008$wtint2yr)
m_HDL= weighted.mean(nhanes2007_2008$lbdhdd,nhanes2007_2008$wtint2yr)
m_TotChol = weighted.mean(nhanes2007_2008$lbxtc,nhanes2007_2008$wtint2yr)
m_sbp = weighted.mean(nhanes2007_2008$asbp,nhanes2007_2008$wtint2yr)
m_smoke = weighted.mean(nhanes2007_2008$isSmoker,nhanes2007_2008$wtint2yr)
m_diabetic = weighted.mean(nhanes2007_2008$isDiabetic,nhanes2007_2008$wtint2yr)
nhanes2007_2008$cox_frs = mapply(get_cox_frs, nhanes2007_2008$riagendr,nhanes2007_2008$ridageyr,nhanes2007_2008$lbdhdd,nhanes2007_2008$lbxtc,nhanes2007_2008$asbp,nhanes2007_2008$isSmoker,nhanes2007_2008$isDiabetic,nhanes2007_2008$wtint2yr)
nhanes2009_2010=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2009_2010_frs.dta")
# Getting cox model based risk levels
nhanes2009_2010= nhanes2009_2010[complete.cases(nhanes2009_2010[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2009_2010$ridageyr,nhanes2009_2010$wtint2yr)
m_HDL= weighted.mean(nhanes2009_2010$lbdhdd,nhanes2009_2010$wtint2yr)
m_TotChol = weighted.mean(nhanes2009_2010$lbxtc,nhanes2009_2010$wtint2yr)
m_sbp = weighted.mean(nhanes2009_2010$asbp,nhanes2009_2010$wtint2yr)
m_smoke = weighted.mean(nhanes2009_2010$isSmoker,nhanes2009_2010$wtint2yr)
m_diabetic = weighted.mean(nhanes2009_2010$isDiabetic,nhanes2009_2010$wtint2yr)
nhanes2009_2010$cox_frs = mapply(get_cox_frs, nhanes2009_2010$riagendr,nhanes2009_2010$ridageyr,nhanes2009_2010$lbdhdd,nhanes2009_2010$lbxtc,nhanes2009_2010$asbp,nhanes2009_2010$isSmoker,nhanes2009_2010$isDiabetic,nhanes2009_2010$wtint2yr)
nhanes2011_2012=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2011_2012_frs.dta")
# Getting cox model based risk levels
nhanes2011_2012= nhanes2011_2012[complete.cases(nhanes2011_2012[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2011_2012$ridageyr,nhanes2011_2012$wtint2yr)
m_HDL= weighted.mean(nhanes2011_2012$lbdhdd,nhanes2011_2012$wtint2yr)
m_TotChol = weighted.mean(nhanes2011_2012$lbxtc,nhanes2011_2012$wtint2yr)
m_sbp = weighted.mean(nhanes2011_2012$asbp,nhanes2011_2012$wtint2yr)
m_smoke = weighted.mean(nhanes2011_2012$isSmoker,nhanes2011_2012$wtint2yr)
m_diabetic = weighted.mean(nhanes2011_2012$isDiabetic,nhanes2011_2012$wtint2yr)
nhanes2011_2012$cox_frs = mapply(get_cox_frs, nhanes2011_2012$riagendr,nhanes2011_2012$ridageyr,nhanes2011_2012$lbdhdd,nhanes2011_2012$lbxtc,nhanes2011_2012$asbp,nhanes2011_2012$isSmoker,nhanes2011_2012$isDiabetic,nhanes2011_2012$wtint2yr)
nhanes2013_2014=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2013_2014_frs.dta")
# Getting cox model based risk levels
nhanes2013_2014= nhanes2013_2014[complete.cases(nhanes2013_2014[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2013_2014$ridageyr,nhanes2013_2014$wtint2yr)
m_HDL= weighted.mean(nhanes2013_2014$lbdhdd,nhanes2013_2014$wtint2yr)
m_TotChol = weighted.mean(nhanes2013_2014$lbxtc,nhanes2013_2014$wtint2yr)
m_sbp = weighted.mean(nhanes2013_2014$asbp,nhanes2013_2014$wtint2yr)
m_smoke = weighted.mean(nhanes2013_2014$isSmoker,nhanes2013_2014$wtint2yr)
m_diabetic = weighted.mean(nhanes2013_2014$isDiabetic,nhanes2013_2014$wtint2yr)
nhanes2013_2014$cox_frs = mapply(get_cox_frs, nhanes2013_2014$riagendr,nhanes2013_2014$ridageyr,nhanes2013_2014$lbdhdd,nhanes2013_2014$lbxtc,nhanes2013_2014$asbp,nhanes2013_2014$isSmoker,nhanes2013_2014$isDiabetic,nhanes2013_2014$wtint2yr)
nhanes2015_2016=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2015_2016_frs.dta")
# Getting cox model based risk levels
nhanes2015_2016= nhanes2015_2016[complete.cases(nhanes2015_2016[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2015_2016$ridageyr,nhanes2015_2016$wtint2yr)
m_HDL= weighted.mean(nhanes2015_2016$lbdhdd,nhanes2015_2016$wtint2yr)
m_TotChol = weighted.mean(nhanes2015_2016$lbxtc,nhanes2015_2016$wtint2yr)
m_sbp = weighted.mean(nhanes2015_2016$asbp,nhanes2015_2016$wtint2yr)
m_smoke = weighted.mean(nhanes2015_2016$isSmoker,nhanes2015_2016$wtint2yr)
m_diabetic = weighted.mean(nhanes2015_2016$isDiabetic,nhanes2015_2016$wtint2yr)
nhanes2015_2016$cox_frs = mapply(get_cox_frs, nhanes2015_2016$riagendr,nhanes2015_2016$ridageyr,nhanes2015_2016$lbdhdd,nhanes2015_2016$lbxtc,nhanes2015_2016$asbp,nhanes2015_2016$isSmoker,nhanes2015_2016$isDiabetic,nhanes2015_2016$wtint2yr)
nhanes2017_2018=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2017_2018_frs.dta")
# Getting cox model based risk levels
nhanes2017_2018= nhanes2017_2018[complete.cases(nhanes2017_2018[ , c("riagendr","ridageyr","lbdhdd","lbxtc","asbp","isSmoker","isDiabetic")]),]
m_age = weighted.mean(nhanes2017_2018$ridageyr,nhanes2017_2018$wtint2yr)
m_HDL= weighted.mean(nhanes2017_2018$lbdhdd,nhanes2017_2018$wtint2yr)
m_TotChol = weighted.mean(nhanes2017_2018$lbxtc,nhanes2017_2018$wtint2yr)
m_sbp = weighted.mean(nhanes2017_2018$asbp,nhanes2017_2018$wtint2yr)
m_smoke = weighted.mean(nhanes2017_2018$isSmoker,nhanes2017_2018$wtint2yr)
m_diabetic = weighted.mean(nhanes2017_2018$isDiabetic,nhanes2017_2018$wtint2yr)
nhanes2017_2018$cox_frs = mapply(get_cox_frs, nhanes2017_2018$riagendr,nhanes2017_2018$ridageyr,nhanes2017_2018$lbdhdd,nhanes2017_2018$lbxtc,nhanes2017_2018$asbp,nhanes2017_2018$isSmoker,nhanes2017_2018$isDiabetic,nhanes2017_2018$wtint2yr)
write_dta(nhanes2017_2018, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2017_2018_frs.dta")
write_dta(nhanes2015_2016, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2015_2016_frs.dta")
write_dta(nhanes2013_2014, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2013_2014_frs.dta")
write_dta(nhanes2011_2012, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanes_2011_2012_frs.dta")
##########################################
##               NHANES III          ##
##########################################
nhanesIIIP1=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P1x_frs.dta")
nhanesIIIP2=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P2x_frs.dta")
nhanesIIIP1= nhanesIIIP1[complete.cases(nhanesIIIP1[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","GHP")]),]
nhanesIIIP2= nhanesIIIP2[complete.cases(nhanesIIIP2[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","GHP")]),]
nhanesIIIP1$frs = mapply(get_cox_frs, nhanesIIIP1$HSSEX,nhanesIIIP1$HSAGEIR,nhanesIIIP1$HDP,nhanesIIIP1$TCP,nhanesIIIP1$PEPMNK1R,nhanesIIIP1$smoke_sts,nhanesIIIP1$GHP,nhanesIIIP1$WTPFHX1)
nhanesIIIP2$frs = mapply(get_cox_frs, nhanesIIIP2$HSSEX,nhanesIIIP2$HSAGEIR,nhanesIIIP2$HDP,nhanesIIIP2$TCP,nhanesIIIP2$PEPMNK1R,nhanesIIIP2$smoke_sts,nhanesIIIP2$GHP,nhanesIIIP2$WTPFHX1)
nhanesIIIP1=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P1x_frs.dta")
nhanesIIIP2=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P2x_frs.dta")
## Dropping rows where values of our risk factor variables are NA
nhanesIIIP1= nhanesIIIP1[complete.cases(nhanesIIIP1[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","GHP")]),]
nhanesIIIP2= nhanesIIIP2[complete.cases(nhanesIIIP2[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","GHP")]),]
nhanesIIIP1$frs = mapply(get_cox_frs, nhanesIIIP1$HSSEX,nhanesIIIP1$HSAGEIR,nhanesIIIP1$HDP,nhanesIIIP1$TCP,nhanesIIIP1$PEPMNK1R,nhanesIIIP1$smoke_sts,nhanesIIIP1$GHP,nhanesIIIP1$WTPFHX1)
nhanesIIIP2$frs = mapply(get_cox_frs, nhanesIIIP2$HSSEX,nhanesIIIP2$HSAGEIR,nhanesIIIP2$HDP,nhanesIIIP2$TCP,nhanesIIIP2$PEPMNK1R,nhanesIIIP2$smoke_sts,nhanesIIIP2$GHP,nhanesIIIP2$WTPFHX1)
View(nhanesIIIP2)
nhanesIIIP1=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P1x_frs.dta")
nhanesIIIP2=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P2x_frs.dta")
## Dropping rows where values of our risk factor variables are NA
nhanesIIIP1= nhanesIIIP1[complete.cases(nhanesIIIP1[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","GHP")]),]
nhanesIIIP2= nhanesIIIP2[complete.cases(nhanesIIIP2[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","GHP")]),]
## GETTING COX FRS SCORES!!
nhanesIIIP1$cox_frs = mapply(get_cox_frs, nhanesIIIP1$HSSEX,nhanesIIIP1$HSAGEIR,nhanesIIIP1$HDP,nhanesIIIP1$TCP,nhanesIIIP1$PEPMNK1R,nhanesIIIP1$smoke_sts,nhanesIIIP1$GHP,nhanesIIIP1$WTPFHX1)
nhanesIIIP2$cox_frs = mapply(get_cox_frs, nhanesIIIP2$HSSEX,nhanesIIIP2$HSAGEIR,nhanesIIIP2$HDP,nhanesIIIP2$TCP,nhanesIIIP2$PEPMNK1R,nhanesIIIP2$smoke_sts,nhanesIIIP2$GHP,nhanesIIIP2$WTPFHX1)
unique(nhanesIIIP1$GHP)
nhanesIIIP1=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P1x_frs.dta")
nhanesIIIP2=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P2x_frs.dta")
## Dropping rows where values of our risk factor variables are NA
nhanesIIIP1= nhanesIIIP1[complete.cases(nhanesIIIP1[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","isDiabetic")]),]
nhanesIIIP2= nhanesIIIP2[complete.cases(nhanesIIIP2[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","isDiabetic")]),]
## GETTING COX FRS SCORES!!
nhanesIIIP1$cox_frs = mapply(get_cox_frs, nhanesIIIP1$HSSEX,nhanesIIIP1$HSAGEIR,nhanesIIIP1$HDP,nhanesIIIP1$TCP,nhanesIIIP1$PEPMNK1R,nhanesIIIP1$isSmoker,nhanesIIIP1$isDiabetic,nhanesIIIP1$WTPFHX1)
nhanesIIIP2$cox_frs = mapply(get_cox_frs, nhanesIIIP2$HSSEX,nhanesIIIP2$HSAGEIR,nhanesIIIP2$HDP,nhanesIIIP2$TCP,nhanesIIIP2$PEPMNK1R,nhanesIIIP2$isSmoker,nhanesIIIP2$isDiabetic,nhanesIIIP2$WTPFHX1)
nhanesIIIP1 = filter(nhanesIIIP1,GHP != 8888)
nhanesIIIP2 = filter(nhanesIIIP2,GHP != 8888)
write_dta(nhanesIIIP1, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P1x_frs.dta")
write_dta(nhanesIIIP2, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_P2x_frs.dta")
##########################################
##               NHANES III          ##
##########################################
nhanesIII=read_dta("/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_frs.dta")
## Dropping rows where values of our risk factor variables are NA
nhanesIII= nhanesIII[complete.cases(nhanesIII[ , c("HSSEX","HSAGEIR","HDP","TCP","PEPMNK1R","smoke_sts","isDiabetic")]),]
## GETTING COX FRS SCORES!!
nhanesIII$cox_frs = mapply(get_cox_frs, nhanesIII$HSSEX,nhanesIII$HSAGEIR,nhanesIII$HDP,nhanesIII$TCP,nhanesIII$PEPMNK1R,nhanesIII$isSmoker,nhanesIII$isDiabetic,nhanesIII$WTPFHX1)
# THIS WAS PREVIOUSLY A PROBLEM - INFLATED THE GLYCOHEMOGLOBIN NUMBERS
# nhanesIIIP1 = filter(nhanesIIIP1,GHP != 8888)
# nhanesIIIP2 = filter(nhanesIIIP2,GHP != 8888)
write_dta(nhanesIIIP1, "/Users/bryankim/Documents/NBER/Framingham /Data/nhanesIII_frs.dta")
